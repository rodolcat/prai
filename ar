local Players           = game:GetService("Players")
local UIS               = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace         = game:GetService("Workspace")
local RunService        = game:GetService("RunService")
local TweenService      = game:GetService("TweenService")

local player     = Players.LocalPlayer
local character  = player.Character or player.CharacterAdded:Wait()
local humanoidRP = character:WaitForChild("HumanoidRootPart")
local playerGui  = player:WaitForChild("PlayerGui")

-- ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name         = "AutoTeleportUI"
gui.ResetOnSpawn = false
gui.Parent       = playerGui

-- Main Frame
local frame = Instance.new("Frame")
frame.Size               = UDim2.new(0, 300, 0, 450)
frame.Position           = UDim2.new(0.6, -150, 0.5, -225)
frame.BackgroundColor3   = Color3.fromRGB(40, 40, 40)
frame.BorderSizePixel    = 0
frame.Active             = true
frame.Draggable          = true
frame.Parent             = gui

-- Tab bar
local tabBar = Instance.new("Frame", frame)
tabBar.Size             = UDim2.new(1, 0, 0, 30)
tabBar.Position         = UDim2.new(0, 0, 0, 0)
tabBar.BackgroundColor3 = Color3.fromRGB(60, 60, 60)

local function newTabButton(name, x)
    local btn = Instance.new("TextButton", tabBar)
    btn.Size             = UDim2.new(0, 0, 1, 0)
    btn.Position         = UDim2.new(0, x, 0, 0)
    btn.Size             = UDim2.new(0, tabBar.AbsoluteSize.X/2, 1, 0)
    btn.Text             = name
    btn.Font             = Enum.Font.SourceSansBold
    btn.TextSize         = 14
    btn.TextColor3       = Color3.new(1,1,1)
    btn.BackgroundColor3 = Color3.fromRGB(80,80,80)
    return btn
end

local mainTabBtn     = newTabButton("Î©îÏù∏",      0)
local teleportTabBtn = newTabButton("ÌÖîÎ†àÌè¨Ìä∏", 0.5)

-- Content container
local content = Instance.new("Frame", frame)
content.Size             = UDim2.new(1, 0, 1, -30)
content.Position         = UDim2.new(0, 0, 0, 30)
content.BackgroundTransparency = 1

-- ‚ñ∂ Î©îÏù∏ ÌÉ≠ Ïª®ÌÖêÏ∏†
local mainFrame = Instance.new("Frame", content)
mainFrame.Size             = UDim2.new(1,0,1,0)
mainFrame.BackgroundTransparency = 1

-- ÏûêÎèôÌöåÌîº Î≤ÑÌäº
local dodgeButton = Instance.new("TextButton", mainFrame)
dodgeButton.Size             = UDim2.new(1, -20, 0, 40)
dodgeButton.Position         = UDim2.new(0, 10, 0, 10)
dodgeButton.Text             = "ÏûêÎèôÌöåÌîº: OFF"
dodgeButton.Font             = Enum.Font.SourceSansBold
dodgeButton.TextSize         = 18
dodgeButton.TextColor3       = Color3.new(1,1,1)
dodgeButton.BackgroundColor3 = Color3.fromRGB(70,130,180)

-- Î¨¥Í∏∞ QTE Î≤ÑÌäº
local qteButton = Instance.new("TextButton", mainFrame)
qteButton.Size             = UDim2.new(1, -20, 0, 40)
qteButton.Position         = UDim2.new(0, 10, 0, 60)
qteButton.Text             = "Î¨¥Í∏∞ QTE: OFF"
qteButton.Font             = Enum.Font.SourceSansBold
qteButton.TextSize         = 18
qteButton.TextColor3       = Color3.new(1,1,1)
qteButton.BackgroundColor3 = Color3.fromRGB(180,100,70)

-- ÌÜ†Î¶¨Ïïà QTE Î≤ÑÌäº
local thorianButton = Instance.new("TextButton", mainFrame)
thorianButton.Size             = UDim2.new(1, -20, 0, 40)
thorianButton.Position         = UDim2.new(0,10,0,110)
thorianButton.Text             = "ÌÜ†Î¶¨Ïïà QTE: OFF"
thorianButton.Font             = Enum.Font.SourceSansBold
thorianButton.TextSize         = 18
thorianButton.TextColor3       = Color3.new(1,1,1)
thorianButton.BackgroundColor3 = Color3.fromRGB(140,70,180)

-- Î¨¥Í∏∞ ÏÑ†ÌÉù Î≤ÑÌäº
_G.AutoDodge      = false
_G.AutoQTE        = false
_G.AutoThorian    = false
_G.SelectedWeapon = "Sword"

local autoDodgeTask, autoQteTask, autoThorianTask

local weapons = {"Sword","Spear","Magic","Dagger","Fist"}
for i, w in ipairs(weapons) do
    local btn = Instance.new("TextButton", mainFrame)
    btn.Size             = UDim2.new(0,100,0,25)
    btn.Position         = UDim2.new(0, 10 + ((i-1)%2)*110, 0, 170 + math.floor((i-1)/2)*30)
    btn.Text             = w
    btn.Font             = Enum.Font.SourceSans
    btn.TextSize         = 14
    btn.TextColor3       = Color3.new(1,1,1)
    btn.BackgroundColor3 = Color3.fromRGB(100,100,100)
    btn.MouseButton1Click:Connect(function()
        _G.SelectedWeapon = w
        print("ÏÑ†ÌÉùÎêú Î¨¥Í∏∞:", w)
    end)
end

-- Í∏∞Îä• Î£®ÌîÑ
local function startAutoDodge()
    while _G.AutoDodge do
        pcall(function()
            local remotes = ReplicatedStorage:FindFirstChild("Remotes")
            local rf = remotes and remotes:FindFirstChild("Information") and remotes.Information:FindFirstChild("RemoteFunction")
            if rf then rf:FireServer({true,true},"DodgeMinigame") end
        end)
        wait(0.2)
    end
end
local function startAutoQTE()
    while _G.AutoQTE do
        pcall(function()
            local remotes = ReplicatedStorage:FindFirstChild("Remotes")
            local rf = remotes and remotes:FindFirstChild("Information") and remotes.Information:FindFirstChild("RemoteFunction")
            if rf then rf:FireServer(true, _G.SelectedWeapon.."QTE") end
        end)
        wait(0.4)
    end
end
local function startAutoThorianQTE()
    while _G.AutoThorian do
        pcall(function()
            local remotes = ReplicatedStorage:FindFirstChild("Remotes")
            local rf = remotes and remotes:FindFirstChild("Information") and remotes.Information:FindFirstChild("RemoteFunction")
            if rf then rf:FireServer(true,"ThorianQTE") end
        end)
        wait(0.4)
    end
end

-- Î≤ÑÌäº Î∞îÏù∏Îî©
dodgeButton.MouseButton1Click:Connect(function()
    _G.AutoDodge = not _G.AutoDodge
    dodgeButton.Text = "ÏûêÎèôÌöåÌîº: "..(_G.AutoDodge and "ON" or "OFF")
    if _G.AutoDodge then autoDodgeTask = task.spawn(startAutoDodge) end
end)
qteButton.MouseButton1Click:Connect(function()
    _G.AutoQTE = not _G.AutoQTE
    qteButton.Text = "Î¨¥Í∏∞ QTE: "..(_G.AutoQTE and "ON" or "OFF")
    if _G.AutoQTE then autoQteTask = task.spawn(startAutoQTE) end
end)
thorianButton.MouseButton1Click:Connect(function()
    _G.AutoThorian = not _G.AutoThorian
    thorianButton.Text = "ÌÜ†Î¶¨Ïïà QTE: "..(_G.AutoThorian and "ON" or "OFF")
    if _G.AutoThorian then autoThorianTask = task.spawn(startAutoThorianQTE) end
end)

-- ‚ñ∂ ÌÖîÎ†àÌè¨Ìä∏ ÌÉ≠ Ïª®ÌÖêÏ∏†
local teleportFrame = Instance.new("Frame", content)
teleportFrame.Size             = UDim2.new(1,0,1,0)
teleportFrame.BackgroundTransparency = 1
teleportFrame.Visible          = false

-- ÌÉÄÏù¥ÌãÄ
local title = Instance.new("TextLabel", teleportFrame)
title.Size             = UDim2.new(1,0,0,30)
title.Position         = UDim2.new(0,0,0,0)
title.Text             = "üß≠ NPC Îπ†Î•∏Ïù¥Îèô"
title.Font             = Enum.Font.SourceSansBold
title.TextSize         = 18
title.TextColor3       = Color3.new(1,1,1)
title.BackgroundTransparency = 1

-- Î¶¨Î°úÎìú Î≤ÑÌäº
local reloadBtn = Instance.new("TextButton", teleportFrame)
reloadBtn.Size             = UDim2.new(1,-20,0,30)
reloadBtn.Position         = UDim2.new(0,10,0,40)
reloadBtn.Text             = "üîÑ NPC Îã§Ïãú Î∂àÎü¨Ïò§Í∏∞"
reloadBtn.Font             = Enum.Font.SourceSansBold
reloadBtn.TextSize         = 14
reloadBtn.TextColor3       = Color3.new(1,1,1)
reloadBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
Instance.new("UICorner", reloadBtn).CornerRadius = UDim.new(0,6)

-- Ïä§ÌÅ¨Î°§
local scroll = Instance.new("ScrollingFrame", teleportFrame)
scroll.Size               = UDim2.new(1,-20,1,-140)
scroll.Position           = UDim2.new(0,10,0,80)
scroll.CanvasSize         = UDim2.new(0,0,0,0)
scroll.AutomaticCanvasSize= Enum.AutomaticSize.Y
scroll.ScrollBarThickness = 8
scroll.BackgroundColor3   = Color3.fromRGB(40,40,40)
local listLayout = Instance.new("UIListLayout", scroll)
listLayout.Padding        = UDim.new(0,5)
listLayout.SortOrder      = Enum.SortOrder.LayoutOrder

local npcButtons = {}
local selectedNPC = nil

local function loadNPCs()
    for _,b in ipairs(npcButtons) do b:Destroy() end
    npcButtons = {}
    selectedNPC = nil
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj:FindFirstChild("HumanoidRootPart") then
            local btn = Instance.new("TextButton")
            btn.Size             = UDim2.new(1,0,0,25)
            btn.Text             = obj.Name
            btn.Font             = Enum.Font.SourceSans
            btn.TextSize         = 14
            btn.TextColor3       = Color3.new(1,1,1)
            btn.BackgroundColor3 = Color3.fromRGB(90,90,90)
            Instance.new("UICorner", btn).CornerRadius=UDim.new(0,4)
            btn.Parent = scroll
            table.insert(npcButtons, btn)
            btn.MouseButton1Click:Connect(function()
                selectedNPC = obj
                for _,ob in ipairs(npcButtons) do ob.BackgroundColor3 = Color3.fromRGB(90,90,90) end
                btn.BackgroundColor3 = Color3.fromRGB(0,170,255)
            end)
        end
    end
end

-- ÌÖîÎ†àÌè¨Ìä∏ Ìï®Ïàò
local function fastTeleportTo(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    local tpPos = target.HumanoidRootPart.Position
    -- Disable collisions
    for _,p in ipairs(character:GetDescendants()) do if p:IsA("BasePart") then p.CanCollide=false end end
    -- Tween Ïù¥Îèô
    local dist = (tpPos - humanoidRP.Position).Magnitude
    local t = dist/200
    local tween = TweenService:Create(humanoidRP, TweenInfo.new(t,Enum.EasingStyle.Linear), {CFrame = CFrame.new(tpPos)})
    tween:Play()
    tween.Completed:Connect(function()
        for _,p in ipairs(character:GetDescendants()) do if p:IsA("BasePart") then p.CanCollide=true end end
    end)
end

-- Î≤ÑÌäº Ïó∞Í≤∞
reloadBtn.MouseButton1Click:Connect(loadNPCs)
loadNPCs()

local tpBtn = Instance.new("TextButton", teleportFrame)
tpBtn.Size             = UDim2.new(1,-20,0,30)
tpBtn.Position         = UDim2.new(0,10,1,-40)
tpBtn.Text             = "üöÄ Ïù¥Îèô"
tpBtn.Font             = Enum.Font.SourceSansBold
tpBtn.TextSize         = 16
tpBtn.TextColor3       = Color3.new(1,1,1)
tpBtn.BackgroundColor3 = Color3.fromRGB(0,128,255)
Instance.new("UICorner", tpBtn).CornerRadius=UDim.new(0,6)
tpBtn.MouseButton1Click:Connect(function()
    if selectedNPC then
        fastTeleportTo(selectedNPC)
    else
        tpBtn.Text = "‚ùó ÏÑ†ÌÉùÌïòÏÑ∏Ïöî"
        wait(1)
        tpBtn.Text = "üöÄ Ïù¥Îèô"
    end
end)

-- ÌÉ≠ Ï†ÑÌôò Î°úÏßÅ
local function showMain()
    mainFrame.Visible     = true
    teleportFrame.Visible = false
    mainTabBtn.BackgroundColor3     = Color3.fromRGB(100,100,100)
    teleportTabBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
end
local function showTeleport()
    mainFrame.Visible     = false
    teleportFrame.Visible = true
    mainTabBtn.BackgroundColor3     = Color3.fromRGB(80,80,80)
    teleportTabBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
end

mainTabBtn.MouseButton1Click     = showMain
teleportTabBtn.MouseButton1Click = showTeleport
showMain()

-- K ÌÇ§Î°ú Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞
UIS.InputBegan:Connect(function(i, p)
    if not p and i.KeyCode==Enum.KeyCode.K then
        frame.Visible = not frame.Visible
    end
end)
